## 9장 단위테스트

---

- 1997년만 해도 TDD라는 개념을 아무도 몰랐다.
- 우리들 대다수에게 단위 테스트란 자기 프로그램이 돌아간다는 사실만 확인하는 일회성 코드에 불과했다.

### TDD 법칙 세 가지

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다. 
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위테스트를 작성한다. 
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.
    - 허나 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 한다.

### 깨끗한 테스트 코드 유지하기

- 실제 코드가 시간이 지남에 따라 진화하면 테스트 코드도 변해야 하는게 문제이다.
- 그런데 테스트 코드가 지저분할수록 변경하기는 어려우며 테스트 코드가 복잡할수록 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸리기 쉽상이다.
- 점차 테스트 코드는 개발자 사이에서 가장 큰 불만으로 자리잡는다.
- 의도하지 않은 결함 수가 많아지면 개발자는 변경을 주저하며 변경하면 득보다 해가 많다고 생각해 더 이상 코드를 정리하지 않는다.
- 고로 테스트 코드는 실제 코드 못지 않게 중요하며 사고와 설계, 주의가 필요하기에 실제 코드 못지 않게 깨끗하게 짜야 한다.
- 테스트 코드를 깨끗하게 유지하지 않으면 결국 존재 가치를 잃어버리게 되기에 코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목이 바로 단위 테스트이다.

### 깨끗한 테스트 코드

- 테스트 코드에서 가독성을 높이려면 명료성, 단순성, 풍부한 표현력이 필요하다.
- 테스트 코드는 최소의 표현으로 많은 것을 나타내야 한다.

### 테스트 당 assert 하나

- Junit으로 테스트 코드를 짤 때는 함수마다 assert 문을 단 하나만 사용해야 한다고 주장하는 학파가 존재한다.
- 확실히 assert 문이 단 하나인 함수는 결론이 하나라서 코드를 이해하기 쉽고 빠르다.
- 단, 경우에 따라 단 하나의 assert 문이 아닌 여러 개를 사용할 순 있으나, 단지 assert 문 개수는 최대한 줄여야 좋다는 생각이다.

### F.I.R.S.T

- 깨끗한 테스트는 다음 다섯 가지 규칙을 따른다.
    1. Fast
        1. 테스트는 빨리 돌아야 한다는 의미로 테스트가 느리면 자주 돌릴 엄두를 못낸다. 자주 돌리지 않으면 초반에 문제를 찾아내어 고치지 못하기에 코드 품질이 망가지기 마련이다. 
    2. Independent
        
        b. 각 테스트는 서로 의존하면 안된다. 각 테스트는 독립적으로, 어떤 순서를 실행해도 괜찮아야 한다. 서로에게 의존하면 잇달아 실패할 수 있어 원인을 진단하기 어려워진다. 
        
    3. Repeatable
        
        c. 테스트는 어떤 환경에서도 반복 가능해야 한다. 실제 환경 어디에서도 실행할 수 있어야 하며 테스트가 돌아가지 않는 환경이 하나라도 있다면 테스트를 수행하지 못하는 상황에 직면한다. 
        
    4. Self-Validating
        
        d. 테스트는 bool값으로 결과를 내야 한다. 테스트가 스스로 성공과 실패를 가늠하지 않는다면 판단은 주관적이 되며 지루한 수작업 평가가 필요하게 된다. 
        
    5. Timely
        
        e. 테스트는 적시에 작성해야 한다. 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다. 실제 코드를 구현한 뒤 테스트 코드를 만들면 테스트가 불가능하도록 실제 코드를 설계할지도 모른다. 
        

### 결론

- 테스트는 실제 코드만큼이나 프로젝트 건강에 중요하며, 어쩌면 실제 코드보다 더 중요할 수도 있다.
- 테스트 코드는 지속적으로 관리해야 하며 표현력을 높이고 간결하게 정리하자
